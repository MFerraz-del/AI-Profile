<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escolha seu modelo - AI-Profile</title>

<!-- Tailwind CSS para estilo -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- html2pdf.js para gerar PDF a partir do HTML -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
  body {
    background: #f9fafb;
  }
  .modelo {
    border: 2px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: border-color 0.3s ease;
    background: white;
    padding: 1rem;
    width: 320px;
    height: 600px;
    overflow-y: auto;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    display: flex;
    flex-direction: column;
  }
  .modelo.selecionado {
    border-color: #4f46e5; /* Indigo 600 */
    box-shadow: 0 0 15px rgba(79, 70, 229, 0.6);
  }
  .modelo h2 {
    border-bottom: 2px solid #ddd;
    margin-bottom: 0.75rem;
  }
  .curriculo-content {
    font-family: 'Open Sans', sans-serif;
    font-size: 14px;
    color: #333;
    flex-grow: 1;
    overflow-y: auto;
  }
  .curriculo-header {
    text-align: center;
    margin-bottom: 1rem;
  }
  .curriculo-header h1 {
    font-size: 28px;
    font-weight: 700;
    color: #4f46e5;
  }
  .curriculo-section {
    margin-bottom: 1rem;
  }
  .curriculo-section h3 {
    font-size: 18px;
    font-weight: 600;
    border-bottom: 1px solid #4f46e5;
    padding-bottom: 0.2rem;
    color: #4f46e5;
    margin-bottom: 0.5rem;
  }
  .curriculo-list {
    list-style: inside disc;
    margin-left: 1rem;
    margin-bottom: 0.5rem;
  }
  .btn-select {
    margin-top: 0.75rem;
  }

  /* Modelo 4 preview - divisão cinza e branca dentro do box padrão */
  #previewModelo4 > div {
    display: flex;
    height: 100%;
    width: 100%;
    box-sizing: border-box;
    font-family: Arial, sans-serif;
    border-radius: 6px;
    overflow: hidden;
  }
  #previewModelo4 .lado-esquerdo {
    background-color: #e0e0e0;
    width: 40%;
    padding: 15px;
    box-sizing: border-box;
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-y: auto;
  }
  #previewModelo4 .lado-esquerdo .foto-usuario {
    width: 100px;
    height: 100px;
    background-color: #bbb;
    border-radius: 50%;
    overflow: hidden;
    margin-bottom: 15px;
    flex-shrink: 0;
  }
  #previewModelo4 .lado-esquerdo .foto-usuario img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  #previewModelo4 .lado-esquerdo section {
    width: 100%;
    margin-bottom: 20px;
  }
  #previewModelo4 .lado-esquerdo h3 {
    border-bottom: 2px solid #666;
    padding-bottom: 5px;
    margin-bottom: 10px;
    font-size: 16px;
  }
  #previewModelo4 .lado-esquerdo ul {
    list-style: inside disc;
    padding-left: 1rem;
    font-size: 13px;
    margin: 0;
  }
  #previewModelo4 .lado-esquerdo p {
    font-size: 13px;
  }

  #previewModelo4 .lado-direito {
    background-color: white;
    width: 60%;
    padding: 20px;
    box-sizing: border-box;
    color: #222;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }
  #previewModelo4 .lado-direito h1 {
    font-size: 26px;
    font-weight: 700;
    color: #4f46e5;
    margin: 0 0 20px 0;
  }
  #previewModelo4 .lado-direito section {
    margin-bottom: 20px;
  }
  #previewModelo4 .lado-direito h3 {
    font-size: 18px;
    font-weight: 600;
    color: #4f46e5;
    margin-bottom: 10px;
  }
  #previewModelo4 .lado-direito p,
  #previewModelo4 .lado-direito ul {
    font-size: 14px;
    line-height: 1.4;
    margin: 0;
  }
  #previewModelo4 .lado-direito ul {
    list-style: disc inside;
  }

  /* Scrollbar customizada para previewModelo4 */
  #previewModelo4 .lado-esquerdo::-webkit-scrollbar,
  #previewModelo4 .lado-direito::-webkit-scrollbar {
    width: 6px;
  }
  #previewModelo4 .lado-esquerdo::-webkit-scrollbar-thumb,
  #previewModelo4 .lado-direito::-webkit-scrollbar-thumb {
    background-color: rgba(0,0,0,0.1);
    border-radius: 3px;
  }

</style>
</head>
<body>

<main class="max-w-7xl mx-auto p-6">
  <h1 class="text-3xl font-bold text-indigo-600 mb-8 text-center">Escolha o modelo do seu currículo</h1>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 justify-center">

    <!-- Modelo 1 - Clássico -->
    <section id="modelo1" class="modelo">
      <h2>Modelo Clássico</h2>
      <div id="previewModelo1" class="curriculo-content">
        <!-- Conteúdo vai ser injetado via JS -->
      </div>
      <button class="btn-select bg-indigo-600 text-white w-full py-2 rounded hover:bg-indigo-700" data-modelo="1">Selecionar Modelo 1</button>
    </section>

    <!-- Modelo 2 - Moderno -->
    <section id="modelo2" class="modelo">
      <h2>Modelo Moderno</h2>
      <div id="previewModelo2" class="curriculo-content">
        <!-- Conteúdo vai ser injetado via JS -->
      </div>
      <button class="btn-select bg-green-600 text-white w-full py-2 rounded hover:bg-green-700" data-modelo="2">Selecionar Modelo 2</button>
    </section>

    <!-- Modelo 3 - Minimalista -->
    <section id="modelo3" class="modelo">
      <h2>Modelo Minimalista</h2>
      <div id="previewModelo3" class="curriculo-content">
        <!-- Conteúdo vai ser injetado via JS -->
      </div>
      <button class="btn-select bg-pink-600 text-white w-full py-2 rounded hover:bg-pink-700" data-modelo="3">Selecionar Modelo 3</button>
    </section>

    <!-- Modelo 4 - Dividido Cinza e Branco -->
    <section id="modelo4" class="modelo">
      <h2>Modelo Dividido</h2>
      <div id="previewModelo4" class="curriculo-content">
        <!-- Conteúdo será injetado via JS -->
      </div>
      <button class="btn-select bg-gray-700 text-white w-full py-2 rounded hover:bg-gray-800" data-modelo="4">
        Selecionar Modelo 4
      </button>
    </section>

  </div>

  <div class="text-center mt-10">
    <button id="btnGerarPDF" class="hidden bg-indigo-700 text-white px-10 py-3 rounded hover:bg-indigo-800">
      Gerar PDF do modelo selecionado
    </button>
  </div>
</main>

<script>
  // Pega o texto salvo no localStorage (substitua pela sua chave)
  const curriculoTexto = localStorage.getItem('curriculoGerado') || "Nenhum currículo gerado.";

  // Função para quebrar o texto em linhas não vazias
  function linhasValidas(texto) {
    return texto.split('\n').map(l => l.trim()).filter(l => l.length > 0);
  }

  // Função para extrair campos simples do texto (ex: Nome, Contato)
  function extrairCampo(texto, campo) {
    const linha = texto.find(l => l.toLowerCase().startsWith(campo.toLowerCase() + ':'));
    return linha ? linha.split(':').slice(1).join(':').trim() : '';
  }

  // Parse básico do currículo em objeto para facilitar o template
  function parseCurriculo(texto) {
    const linhas = linhasValidas(texto);
    let obj = {
      nome: extrairCampo(linhas, 'Nome'),
      contato: extrairCampo(linhas, 'Contato'),
      objetivo: [],
      experiencias: [],
      formacao: [],
      idiomas: [],
      habilidades: [],
    };

    let secaoAtual = null;
    linhas.forEach(linha => {
      const l = linha.toLowerCase();

      if (l.includes('objetivo profissional')) {
        secaoAtual = 'objetivo';
        return;
      }
      if (l.includes('experiências profissionais') || l.includes('experiencias profissionais')) {
        secaoAtual = 'experiencias';
        return;
      }
      if (l.includes('formação acadêmica') || l.includes('formacao academica')) {
        secaoAtual = 'formacao';
        return;
      }
      if (l.includes('idiomas')) {
        secaoAtual = 'idiomas';
        return;
      }
      if (l.includes('habilidades')) {
        secaoAtual = 'habilidades';
        return;
      }

      // Preenche as seções
      if (secaoAtual && !linha.toLowerCase().startsWith('nome') && !linha.toLowerCase().startsWith('contato')) {
        obj[secaoAtual].push(linha);
      }
    });

    return obj;
  }

  const dados = parseCurriculo(curriculoTexto);

  // Renderiza Modelo 1 (Clássico)
  function renderModelo1(dados) {
    return `
      <div class="curriculo-header">
        <h1>${dados.nome}</h1>
        <p>${dados.contato}</p>
      </div>
      <div class="curriculo-section">
        <h3>Objetivo Profissional</h3>
        <p>${dados.objetivo.join(' ') || 'Não informado'}</p>
      </div>
      <div class="curriculo-section">
        <h3>Experiências Profissionais</h3>
        <ul class="curriculo-list">${dados.experiencias.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
      </div>
      <div class="curriculo-section">
        <h3>Formação Acadêmica</h3>
        <ul class="curriculo-list">${dados.formacao.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
      </div>
      <div class="curriculo-section">
        <h3>Idiomas</h3>
        <ul class="curriculo-list">${dados.idiomas.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
      </div>
      <div class="curriculo-section">
        <h3>Habilidades</h3>
        <ul class="curriculo-list">${dados.habilidades.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
      </div>
    `;
  }

  // Renderiza Modelo 2 (Moderno)
  function renderModelo2(dados) {
    return `
      <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #064e3b;">
        <div class="curriculo-header">
          <h1 style="font-weight: 900; font-size: 32px; color: #065f46;">${dados.nome}</h1>
          <p style="font-style: italic; font-size: 14px; margin-bottom: 1rem;">${dados.contato}</p>
        </div>
        <div class="curriculo-section">
          <h3 style="color: #059669;">Objetivo Profissional</h3>
          <p>${dados.objetivo.join(' ') || 'Não informado'}</p>
        </div>
        <div class="curriculo-section">
          <h3 style="color: #059669;">Experiências Profissionais</h3>
          <ul class="curriculo-list">${dados.experiencias.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
        </div>
        <div class="curriculo-section">
          <h3 style="color: #059669;">Formação Acadêmica</h3>
          <ul class="curriculo-list">${dados.formacao.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
        </div>
        <div class="curriculo-section">
          <h3 style="color: #059669;">Idiomas</h3>
          <ul class="curriculo-list">${dados.idiomas.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
        </div>
        <div class="curriculo-section">
          <h3 style="color: #059669;">Habilidades</h3>
          <ul class="curriculo-list">${dados.habilidades.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
        </div>
      </div>
    `;
  }

  // Renderiza Modelo 3 (Minimalista)
  function renderModelo3(dados) {
    return `
      <div style="font-family: 'Courier New', Courier, monospace; color: #831843; text-align: center;">
        <div class="curriculo-header">
          <h1 style="font-weight: 600; font-size: 26px; margin-bottom: 0.5rem;">${dados.nome}</h1>
          <p style="font-style: italic; font-size: 13px; margin-bottom: 1.5rem;">${dados.contato}</p>
        </div>
        <div class="curriculo-section" style="text-align:left;">
          <h3>Objetivo Profissional</h3>
          <p>${dados.objetivo.join(' ') || 'Não informado'}</p>
        </div>
        <div class="curriculo-section" style="text-align:left;">
          <h3>Experiências Profissionais</h3>
          <ul class="curriculo-list">${dados.experiencias.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
        </div>
        <div class="curriculo-section" style="text-align:left;">
          <h3>Formação Acadêmica</h3>
          <ul class="curriculo-list">${dados.formacao.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
        </div>
        <div class="curriculo-section" style="text-align:left;">
          <h3>Idiomas</h3>
          <ul class="curriculo-list">${dados.idiomas.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
        </div>
        <div class="curriculo-section" style="text-align:left;">
          <h3>Habilidades</h3>
          <ul class="curriculo-list">${dados.habilidades.map(item => `<li>${item}</li>`).join('') || '<li>Não informado</li>'}</ul>
        </div>
      </div>
    `;
  }

  // Renderiza Modelo 4 (Dividido cinza/branco)
  function renderModelo4(dados) {
    return `
      <div>
        <div class="lado-esquerdo">
          <div class="foto-usuario">
            <img src="https://via.placeholder.com/100?text=Foto" alt="Foto do usuário" />
          </div>

          <section>
            <h3>Contato</h3>
            <p>${dados.contato || 'Não informado'}</p>
          </section>

          <section>
            <h3>Idiomas</h3>
            <ul>${dados.idiomas.length > 0 ? dados.idiomas.map(i => `<li>${i}</li>`).join('') : '<li>Não informado</li>'}</ul>
          </section>

          <section>
            <h3>Habilidades</h3>
            <ul>${dados.habilidades.length > 0 ? dados.habilidades.map(h => `<li>${h}</li>`).join('') : '<li>Não informado</li>'}</ul>
          </section>
        </div>

        <div class="lado-direito">
          <h1>${dados.nome || 'Nome não informado'}</h1>

          <section>
            <h3>Objetivo Profissional</h3>
            <p>${dados.objetivo.join(' ') || 'Não informado'}</p>
          </section>

          <section>
            <h3>Experiências Profissionais</h3>
            <ul>${dados.experiencias.length > 0 ? dados.experiencias.map(e => `<li>${e}</li>`).join('') : '<li>Não informado</li>'}</ul>
          </section>

          <section>
            <h3>Formação Acadêmica</h3>
            <ul>${dados.formacao.length > 0 ? dados.formacao.map(f => `<li>${f}</li>`).join('') : '<li>Não informado</li>'}</ul>
          </section>
        </div>
      </div>
    `;
  }

  // Renderizar todas as prévias
  function renderPreviews() {
    document.getElementById('previewModelo1').innerHTML = renderModelo1(dados);
    document.getElementById('previewModelo2').innerHTML = renderModelo2(dados);
    document.getElementById('previewModelo3').innerHTML = renderModelo3(dados);
    document.getElementById('previewModelo4').innerHTML = renderModelo4(dados);
  }

  renderPreviews();

  // Seleção de modelo
  let modeloSelecionado = null;

  document.querySelectorAll('.btn-select').forEach(btn => {
    btn.addEventListener('click', () => {
      modeloSelecionado = btn.getAttribute('data-modelo');

      // Remove seleção anterior
      document.querySelectorAll('.modelo').forEach(sec => sec.classList.remove('selecionado'));
      btn.parentElement.classList.add('selecionado');

      document.getElementById('btnGerarPDF').classList.remove('hidden');
    });
  });

  // Botão gerar PDF
  document.getElementById('btnGerarPDF').addEventListener('click', () => {
    if (!modeloSelecionado) {
      alert('Por favor, selecione um modelo antes de gerar o PDF.');
      return;
    }

    let elementoParaPDF;

    switch(modeloSelecionado) {
      case '1':
        elementoParaPDF = document.getElementById('previewModelo1');
        break;
      case '2':
        elementoParaPDF = document.getElementById('previewModelo2');
        break;
      case '3':
        elementoParaPDF = document.getElementById('previewModelo3');
        break;
      case '4':
        elementoParaPDF = document.getElementById('previewModelo4');
        break;
      default:
        alert('Modelo inválido.');
        return;
    }

    const opt = {
      margin:       10,
      filename:     `curriculo_modelo${modeloSelecionado}.pdf`,
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2, scrollY: -window.scrollY },
      jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(elementoParaPDF).save();
  });
</script>

</body>
</html>
